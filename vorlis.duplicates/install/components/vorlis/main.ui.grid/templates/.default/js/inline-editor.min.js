(function(){"use strict";BX.namespace("BX.Grid");BX.Grid.InlineEditor=function(t,e){this.parent=null;this.types=null;this.init(t,e)};BX.Grid.InlineEditor.prototype={init:function(parent,types){this.parent=parent;try{this.types=eval(types)}catch(t){this.types=null}},createContainer:function(){return BX.create("div",{props:{className:this.parent.settings.get("classEditorContainer")}})},createTextarea:function(t,e){var i=BX.create("textarea",{props:{className:[this.parent.settings.get("classEditor"),this.parent.settings.get("classEditorTextarea")].join(" ")},attrs:{name:t.NAME,style:"height:"+e+"px"},html:t.VALUE});return i},createInput:function(t){var e=this.parent.settings.get("classEditorText");var i={value:t.VALUE!==undefined&&t.VALUE!==null?BX.util.htmlspecialcharsback(t.VALUE):"",name:t.NAME!==undefined&&t.NAME!==null?t.NAME:""};if(t.TYPE===this.types.CHECKBOX){e=this.parent.settings.get("classEditorCheckbox");i.type="checkbox";i.checked=i.value=="Y"}if(t.TYPE===this.types.DATE){e=[e,this.parent.settings.get("classEditorDate")].join(" ")}if(t.TYPE===this.types.NUMBER){e=[e,this.parent.settings.get("classEditorNumber")].join(" ");i.type="number"}if(t.TYPE===this.types.RANGE){e=[e,this.parent.settings.get("classEditorRange")].join(" ");i.type="range";if(BX.type.isPlainObject(t.DATA)){i.min=t.DATA.MIN||"0";i.max=t.DATA.MAX||99999;i.step=t.DATA.STEP||""}}e=[this.parent.settings.get("classEditor"),e].join(" ");return BX.create("input",{props:{className:e,id:t.NAME+"_control"},attrs:i})},createCustom:function(t){var e=this.parent.settings.get("classEditorCustom");e=[this.parent.settings.get("classEditor"),e].join(" ");return BX.create("div",{props:{className:e},attrs:{"data-name":t.NAME},html:t.VALUE||""})},createOutput:function(t){return BX.create("output",{props:{className:this.parent.settings.get("classEditorOutput")||""},attrs:{for:t.NAME+"_control"},text:t.VALUE||""})},getDropdownValueItemByValue:function(t,e){var i=t.filter(function(t){return t.VALUE===e});return i.length>0?i[0]:t[0]},createDropdown:function(t){var e=this.getDropdownValueItemByValue(t.DATA.ITEMS,t.VALUE);return BX.create("div",{props:{className:[this.parent.settings.get("classEditor"),"main-dropdown main-grid-editor-dropdown"].join(" "),id:t.NAME+"_control"},attrs:{name:t.NAME,"data-items":JSON.stringify(t.DATA.ITEMS),"data-value":e.VALUE},children:[BX.create("span",{props:{className:"main-dropdown-inner"},html:e.NAME})]})},validateEditObject:function(t){return BX.type.isPlainObject(t)&&"TYPE"in t&&"NAME"in t&&"VALUE"in t&&(!("items"in t)||BX.type.isArray(t.items)&&t.items.length)},initCalendar:function(t){BX.calendar({node:t.target,field:t.target})},bindOnRangeChange:function(t,e){function i(t,e){BX.html(e,t.value);var i=parseFloat(t.value);var n=parseFloat(t.getAttribute("max"));var a=parseFloat(t.getAttribute("min"));var r=16;var s=n-a;var o=(i-a)/s*100;var c=Math.round(r*o/100)-r/2;e.style.left=o+"%";e.style.marginLeft=-c+"px"}setTimeout(function(){i(t,e)},0);BX.bind(t,"input",function(){i(t,e)})},createImageEditor:function(t){var e=BX.create("div",{props:{className:"main-grid-image-editor main-grid-editor"},attrs:{name:t.NAME},children:[BX.create("div",{props:{className:"main-grid-image-editor-left"},children:[BX.create("img",{props:{className:"main-grid-image-editor-preview"},attrs:{src:t.VALUE}})]}),BX.create("div",{props:{className:"main-grid-image-editor-right"},children:[BX.create("button",{props:{className:"ui-btn ui-btn-xs"},text:this.parent.getParam("MAIN_UI_GRID_IMAGE_EDITOR_BUTTON_EDIT"),events:{click:function(t){t.preventDefault();var i=e.querySelector(".main-grid-image-editor-file-input");if(BX.type.isDomNode(i)){i.click()}}}})]}),BX.create("input",{props:{className:"main-grid-image-editor-file-input"},attrs:{type:"file",accept:"image/*",name:t.NAME},events:{change:function(t){var i=e.querySelector(".main-grid-image-editor-preview");if(BX.type.isDomNode(i)){var n=new FileReader;n.onload=function(t){i.src=t.currentTarget.result};n.readAsDataURL(t.target.files[0])}}}})]});return e},getEditor:function(t,e){var i,n;var a=this.createContainer();if(this.validateEditObject(t)){t.VALUE=t.VALUE===null?"":t.VALUE;switch(t.TYPE){case this.types.TEXT:{i=this.createInput(t);BX.bind(i,"click",function(t){t.stopPropagation()});BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.DATE:{i=this.createInput(t);BX.bind(i,"click",this.initCalendar);BX.bind(i,"click",function(t){t.stopPropagation()});BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.NUMBER:{i=this.createInput(t);BX.bind(i,"click",function(t){t.stopPropagation()});BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.RANGE:{i=this.createInput(t);n=this.createOutput(t);this.bindOnRangeChange(i,n);BX.bind(i,"click",function(t){t.stopPropagation()});BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.CHECKBOX:{i=this.createInput(t);BX.bind(i,"click",function(t){t.stopPropagation()});BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.TEXTAREA:{i=this.createTextarea(t,e);BX.bind(i,"click",function(t){t.stopPropagation()});BX.bind(i,"keydown",BX.delegate(this._onControlKeydown,this));break}case this.types.DROPDOWN:{i=this.createDropdown(t);break}case this.types.IMAGE:{i=this.createImageEditor(t);break}case this.types.CUSTOM:{i=this.createCustom(t);requestAnimationFrame(function(){if(t.HTML){var e=BX.processHTML(t.HTML);e.SCRIPT.forEach(function(t){if(t.isInternal&&t.JS){BX.evalGlobal(t.JS)}})}});BX.bind(i,"click",function(t){t.stopPropagation()});break}default:{break}}}if(BX.type.isDomNode(n)){a.appendChild(n)}if(BX.type.isDomNode(i)){a.appendChild(i)}return a},_onControlKeydown:function(t){if(t.code==="Enter"){t.stopPropagation();t.preventDefault();var e=BX.Grid.Utils.getBySelector(this.parent.getContainer(),"#grid_save_button > button",true);if(e){BX.fireEvent(e,"click")}}}}})();
//# sourceMappingURL=inline-editor.map.js